<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Lost Items</title>
    <script type="module">
        // Import Firebase services using the modular SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

        // Firebase configuration object
        const firebaseConfig = {
            apiKey: "AIzaSyBK4x087mtwGGUj7AsrNs0xzJsrhu2OoVQ",
            authDomain: "garage-form.firebaseapp.com",
            projectId: "garage-form",
            storageBucket: "garage-form.appspot.com",
            messagingSenderId: "557862900022",
            appId: "1:557862900022:web:6efd51cf1d2ff8ebf62397"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to display all lost items in a table
        async function displayAllLostItems() {
            const allLostItemsContainer = document.getElementById('allLostItemsContainer');

            try {
                const usersCollectionRef = collection(db, 'users');
                const usersSnapshot = await getDocs(usersCollectionRef);

                let tableHTML = `
                    <table>
                        <tr>
                            <th>Item Name</th>
                            <th>Description</th>
                            <th>Contact Info</th>
                            <th>Username</th>
                        </tr>
                `;

                for (const userDoc of usersSnapshot.docs) {
                    const userId = userDoc.id;
                    const userDocRef = doc(db, 'users', userId);
                    const userDocSnap = await getDoc(userDocRef);
                    const userData = userDocSnap.data();
                    const username = userData?.userName || 'N/A';

                    const lostCollectionRef = collection(db, 'users', userId, 'Lost');
                    const lostSnapshot = await getDocs(lostCollectionRef);

                    lostSnapshot.forEach((itemDoc) => {
                        const lostItem = itemDoc.data();
                        console.log('Lost item:', lostItem);
                        tableHTML += `
                            <tr>
                                <td>${lostItem.itemName || 'N/A'}</td>
                                <td>${lostItem.itemDescription || 'N/A'}</td>
                                <td>${lostItem.contactInfo || 'N/A'}</td>
                                <td>${username}</td>
                            </tr>
                        `;
                    });
                }

                tableHTML += '</table>';
                allLostItemsContainer.innerHTML = tableHTML;
            } catch (error) {
                console.error('Error fetching data:', error);
                allLostItemsContainer.innerHTML = '<p>Error loading lost items: ' + error.message + '</p>';
            }
        }

        // Call the function to display all lost items when the page loads
        window.onload = displayAllLostItems;
    </script>
</head>
<style>
       * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "poppins", sans-serif;
        }

        body {
            background-color: #c9d6ff;
            background: linear-gradient(to right, #e2e2e2, #c9d6ff);
        }

        tr{
            background-color: white;
        }

</style>
<body>
    <div id="allLostItemsContainer"></div>
</body>
</html>